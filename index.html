<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Brutto-Netto-Rechner für Zeitarbeit (AZK & Nachtschicht)</title>
<meta name="description" content="Schneller Brutto-Netto-Rechner für Zeitarbeit mit AZK-Übersicht, Nachtschicht-Zulage (25 %), Steuerklasse, Kirchensteuer & Krankenkasse.">
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@900&family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet" />
<style>
/* ========== Design Tokens ========== */
:root{
  --tp-blue:#0b2d42;
  --tp-blue-2:#123a57;
  --tp-green:#b6de36;
  --tp-bg:#edf2f0;
  --tp-muted:#6f8a9b;
  --radius:14px;
  --shadow:0 10px 26px rgba(11,45,66,.14);
}

/* ========== Base ========== */
*{box-sizing:border-box}
html,body{margin:0}
body{
  font:400 16px/1.6 "Nunito Sans",system-ui,sans-serif;
  color:var(--tp-blue);
  background:var(--tp-bg) url("assets/img/hintergrund.png") center/cover fixed;
}
.container{max-width:1200px;margin:32px auto;padding:0 20px}

/* Cards */
.card{border-radius:20px;background:#fff;border:1px solid #dfe6ea;box-shadow:var(--shadow);overflow:hidden}
.card.hero{background:linear-gradient(180deg,#0b2d42,#123a57);color:#fff;border:none}
.hero-inner{padding:26px}

/* Typo */
h1{font:900 clamp(26px,4.6vw,40px)/1.15 "Poppins",sans-serif;margin:0}
h2{font:900 20px/1.2 "Poppins",sans-serif;margin:0 0 12px;color:var(--tp-blue)}
.hero-bullets{list-style:none;margin:12px 0 0;padding:0;display:flex;gap:8px;flex-wrap:wrap}
.hero-bullets li{font-weight:700;font-size:12px;color:#eaf3f8;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:8px 10px;border-radius:999px}

/* Panels */
.panel{padding:20px}

/* Form */
label{display:block;font-weight:700;margin:0 0 6px}
.hint{font-size:12px;color:var(--tp-muted);margin-top:6px}
input,select{
  width:100%;padding:14px 16px;border:2px solid #c9d3da;border-radius:var(--radius);
  background:#fff;color:var(--tp-blue);outline:0;transition:border-color .15s,box-shadow .15s
}
input:focus,select:focus{border-color:var(--tp-green);box-shadow:0 0 0 3px rgba(182,222,54,.25)}
fieldset{border:0;margin:18px 0 0;padding:0}
legend{font:900 16px/1.2 "Poppins";margin-bottom:8px}

.grid-2{display:grid;grid-template-columns:1fr;gap:16px}
.grid-3{display:grid;grid-template-columns:1fr;gap:16px}

/* Buttons */
.btn{
  appearance:none;display:inline-flex;align-items:center;justify-content:center;gap:10px;
  padding:15px 18px;font:700 16px/1 "Nunito Sans";border-radius:var(--radius);cursor:pointer;
  border:2px solid var(--tp-green);transition:transform .04s,box-shadow .2s,background .2s
}
.btn:active{transform:translateY(1px)}
.btn-primary{background:var(--tp-blue);color:#fff}
.btn-primary:hover{box-shadow:0 8px 18px rgba(11,45,66,.35)}
.btn-secondary{background:#fff;color:var(--tp-blue)}
.btn-secondary:hover{background:rgba(182,222,54,.12)}
.form-actions{margin-top:22px}
@media (max-width:640px){.btn{width:100%}}

/* Toggles (flach) */
.switch{display:inline-grid;grid-auto-flow:column;align-items:center;gap:12px}
.switch input{
  appearance:none;width:44px;height:20px;border-radius:10px;background:#b9c7d1;border:1px solid #a9bac5;position:relative;cursor:pointer
}
.switch input::after{content:"";position:absolute;left:2px;top:2px;width:16px;height:16px;border-radius:8px;background:#fff;box-shadow:0 0 2px rgba(0,0,0,.25);transition:transform .2s}
.switch input:checked{background:var(--tp-green);border-color:var(--tp-green)}
.switch input:checked::after{transform:translateX(24px)}

/* Ergebnis */
.card.result{padding:22px}
.result-head{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px}
.net{font:900 32px/1 "Poppins";color:var(--tp-green)}
.bar{height:10px;background:#e4ecf1;border-radius:999px;overflow:hidden;margin:12px 0}
.bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--tp-green),#d5f16a);width:0%}
#details .row{display:grid;grid-template-columns:1fr auto;gap:14px;padding:10px 0;border-bottom:1px solid #e9eef1}
#details .row:last-child{border-bottom:0}
.note{font-size:12px;color:#4c5f6b}

/* Autocomplete */
.autocomplete{position:relative}
.autocomplete input{width:100%;max-width:100%}
.suggestions{
  position:absolute;left:0;right:0;top:calc(100% + 6px);
  background:#fff;border:1px solid #dfe6ea;border-radius:12px;box-shadow:var(--shadow);
  max-height:320px;overflow:auto;padding:6px 0;margin:0;display:none;z-index:50
}
.suggestions.show{display:block}
.suggestions li{list-style:none;padding:10px 14px;cursor:pointer;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.suggestions li + li{border-top:1px solid #f2f5f7}
.suggestions li:hover,.suggestions li[aria-selected="true"]{background:#f3f8e9}

/* Desktop */
@media (min-width:1120px){
  .layout{display:grid;grid-template-columns:minmax(620px,1fr) 500px;gap:28px;align-items:start}
  .sticky{position:sticky;top:24px}
  .grid-2{grid-template-columns:1fr 1fr;gap:20px}
  .grid-3{grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
}
@media (min-width:1400px){
  .layout{grid-template-columns:minmax(660px,1fr) 520px;gap:32px}
}

/* Utility */
.hidden{display:none}
</style>
</head>
<body>
<main class="container">

  <!-- HERO -->
  <section class="card hero">
    <div class="hero-inner">
      <h1>Brutto-Netto-Rechner für Zeitarbeit</h1>
      <ul class="hero-bullets">
        <li>Schnell zum Netto</li><li>AZK transparent</li><li>Einfach & mobil</li>
      </ul>
    </div>
  </section>

  <!-- INTRO -->
  <section id="intro" class="card panel" aria-label="Start">
    <h2>Los geht’s – dein Beruf</h2>
    <label for="job">Beruf / Tätigkeit</label>
    <div class="autocomplete">
      <input id="job" type="text" autocomplete="off" placeholder="Tippe mind. 4 Zeichen, z. B. Lager…">
      <ul id="jobSuggest" class="suggestions" role="listbox" aria-label="Berufsvorschläge"></ul>
    </div>
    <p class="hint">Mindestens 4 Zeichen – bis zu 34 Vorschläge. Du kannst auch frei eingeben.</p>
    <div class="form-actions"><button id="startBtn" class="btn btn-primary" type="button">Rechner starten</button></div>
  </section>

  <!-- TOOL -->
  <section id="tool" class="layout hidden" aria-label="Rechner">
    <!-- Eingaben -->
    <section class="card panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:6px">
        <h2 style="margin:0">Eingaben</h2>
        <button id="backBtn" class="btn btn-secondary" type="button">Zurück</button>
      </div>

      <form id="calcForm" novalidate>
        <fieldset>
          <legend>Basis</legend>
          <div class="grid-2">
            <div>
              <label for="hourly">Stundenlohn (EUR/Std)</label>
              <input id="hourly" type="number" step="0.01" min="0" value="15" />
              <div class="hint">Monatsbrutto basiert auf 151,67 Std.</div>
            </div>
            <div>
              <label for="hoursActual">Gesamtstunden (Monat)</label>
              <input id="hoursActual" type="number" step="0.01" min="0" value="160" />
              <div class="hint">Alles über 151,67 Std geht ins AZK.</div>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Nachtschicht</legend>
          <div class="grid-2">
            <div class="switch">
              <input id="permanent" type="checkbox" />
              <label for="permanent">Dauernachtschicht (100 % Nachtstunden)</label>
            </div>
            <div id="nightBox">
              <label for="nightHours">Nachtstunden (Monat)</label>
              <input id="nightHours" type="number" step="0.01" min="0" value="20" />
              <div class="hint">Bei „Dauernacht“ nicht erforderlich.</div>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Steuern &amp; Sozialversicherung</legend>
          <div class="grid-3">
            <div>
              <label for="state">Bundesland</label>
              <select id="state">
                <option>Baden-Württemberg</option><option>Bayern</option><option>Berlin</option><option>Brandenburg</option>
                <option>Bremen</option><option>Hamburg</option><option>Hessen</option><option>Mecklenburg-Vorpommern</option>
                <option>Niedersachsen</option><option selected>Nordrhein-Westfalen</option><option>Rheinland-Pfalz</option>
                <option>Saarland</option><option>Sachsen</option><option>Sachsen-Anhalt</option>
                <option>Schleswig-Holstein</option><option>Thüringen</option>
              </select>
              <div class="switch" style="margin-top:10px">
                <input id="church" type="checkbox" />
                <label for="church">Kirchensteuerpflichtig</label>
              </div>
            </div>

            <div>
              <label for="taxClass">Steuerklasse</label>
              <select id="taxClass">
                <option value="1">I</option><option value="2">II</option><option value="3" selected>III</option>
                <option value="4">IV</option><option value="5">V</option><option value="6">VI</option>
              </select>
              <div class="hint">III niedrig, V hoch, I/IV mittel, II etwas günstiger, VI sehr hoch.</div>
            </div>

            <div>
              <label for="health">Krankenkasse – Zusatzbeitrag (%)</label>
              <input id="health" type="number" step="0.1" value="1.7" />
              <div class="hint">Typisch ~1,7 % (AN-Anteil = 7,3 % + Zusatz/2).</div>
            </div>
          </div>

          <div class="grid-3" style="margin-top:14px">
            <div>
              <label for="childless">Kinder vorhanden?</label>
              <select id="childless">
                <option value="no" selected>ja (mit Kind)</option>
                <option value="yes">nein (kinderlos)</option>
              </select>
            </div>
            <div id="childrenWrapper">
              <label for="children">Kinder (Anzahl)</label>
              <input id="children" type="number" min="0" step="1" value="0" />
            </div>
          </div>
        </fieldset>

        <div class="form-actions">
          <button id="calc" type="button" class="btn btn-primary">Netto berechnen</button>
        </div>
      </form>
    </section>

    <!-- Ergebnis -->
    <aside id="resultWrap" class="card result sticky hidden" aria-live="polite">
      <h2>Ergebnis</h2>
      <div class="result-head">
        <div>Dein Netto</div>
        <div class="net" id="netOut">–</div>
      </div>
      <div class="bar" aria-label="Netto-Anteil von Brutto"><i id="barfill" style="width:0%"></i></div>
      <p class="note">Diese Berechnung ist eine vereinfachte, realistische Netto-Schätzung. Abweichungen von ca. ±5 % sind möglich.</p>

      <details style="margin-top:10px">
        <summary>Berechnung im Detail</summary>
        <div id="details" style="margin-top:10px"></div>
      </details>

      <div class="form-actions">
        <button id="recalc" class="btn btn-secondary" type="button">Neu berechnen</button>
      </div>
    </aside>
  </section>
</main>

<script>
/* ========== Helpers ========== */
const $ = (id) => document.getElementById(id);
const HOURS = 151.67;
const euro = (n) => new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR'}).format(n);
const clamp = (v,a,b) => Math.min(b,Math.max(a,v));
const churchPct = (s) => (s==="Bayern"||s==="Baden-Württemberg")?8:9;

/* ========== Navigation ========== */
$('startBtn').onclick = () => {
  if (!$('job').value.trim()) { $('job').focus(); return; }
  $('intro').classList.add('hidden');
  $('tool').classList.remove('hidden');
  $('hourly').focus();
};
$('backBtn').onclick = () => {
  $('tool').classList.add('hidden');
  $('intro').classList.remove('hidden');
  $('job').focus();
};

/* UX: Felder ein-/ausblenden */
$('permanent').onchange = (e)=>{ $('nightBox').classList.toggle('hidden', e.target.checked); };
$('childless').addEventListener('change', (e)=>{ $('childrenWrapper').style.display = e.target.value==='no' ? 'block' : 'none'; });

/* ========== Sozialabgaben (vereinfacht, AN-Anteil) ========== */
function sv(gross, zusatz, isChildless, state){
  const kv = gross*(0.073 + (zusatz/100)/2);
  const rv = gross*0.093;
  const av = gross*0.013;
  let pv = gross*(isChildless?0.023:0.017);
  if(state==="Sachsen") pv += gross*0.0035;
  return {t:kv+rv+av+pv, kv, rv, av, pv};
}

/* ========== Lohnsteuer (vereinfachte Klassen-Schätzung) ========== */
function tax(taxable, klass, children){
  const base = ({1:.16,2:.15,3:.08,4:.16,5:.24,6:.30}[+klass]) ?? .16;
  const relief = Math.min(.02, .01*(+children||0));
  const rate = Math.max(0, base - relief);
  return {a: taxable*rate, r: rate};
}

/* ========== Berechnung ========== */
function calculate(){
  const h=+$('hourly').value||0,
        hs=+$('hoursActual').value||0,
        nh=+$('nightHours').value||0,
        permanent=$('permanent').checked,
        state=$('state').value,
        klass=$('taxClass').value,
        zusatz=+$('health').value||1.7,
        kids=+$('children').value||0,
        childless=$('childless').value==='yes',
        churchOn=$('church').checked;

  const base = h*HOURS;
  const extra = Math.max(0, hs-HOURS);
  const azk = extra*h;

  const fraction = permanent ? 1 : (hs ? clamp(nh/hs,0,1) : 0);
  const night = base*0.25*fraction;

  const gross = base + night;
  const S = sv(gross, zusatz, childless, state);
  const taxable = Math.max(0, gross - S.t);
  const T = tax(taxable, klass, kids);
  const cp = churchOn ? churchPct(state) : 0;
  const church = T.a*(cp/100);
  const deductions = S.t + T.a + church;
  const net = Math.max(0, gross - deductions);
  const pct = gross ? Math.round(net/gross*100) : 0;

  $('resultWrap').classList.remove('hidden');
  $('netOut').textContent = euro(net);
  $('barfill').style.width = pct + '%';

  $('details').innerHTML = `
    <div class="row"><div>Stundenlohn × 151,67 Std</div><div><b>${euro(base)}</b></div></div>
    <div class="row"><div>Nachtzuschlag (25 % · ${permanent?'Dauernacht':(fraction*100).toFixed(0)+'%'})</div><div><b>+ ${euro(night)}</b></div></div>
    <div class="row"><div>AZK-Zuwachs</div><div><b>+ ${extra.toFixed(2)} Std (${euro(azk)})</b></div></div>
    <div class="row"><div>Sozialabgaben ges.</div><div><b>− ${euro(S.t)}</b></div></div>
    <div class="row"><div>— KV (inkl. Zusatz/2)</div><div><b>− ${euro(S.kv)}</b></div></div>
    <div class="row"><div>— RV</div><div><b>− ${euro(S.rv)}</b></div></div>
    <div class="row"><div>— AV</div><div><b>− ${euro(S.av)}</b></div></div>
    <div class="row"><div>— PV ${state==='Sachsen'?'(+0,35 % Sachsen)':''}</div><div><b>− ${euro(S.pv)}</b></div></div>
    <div class="row"><div>Lohnsteuer (Kl. ${klass})</div><div><b>− ${euro(T.a)}</b></div></div>
    <div class="row"><div>Kirchensteuer ${churchOn?'('+cp+' %)':'(aus)'}</div><div><b>− ${euro(church)}</b></div></div>
  `;
}
$('calc').onclick = calculate;
$('recalc').onclick = ()=>{ $('resultWrap').classList.add('hidden'); $('calcForm').scrollIntoView({behavior:'smooth'}); };

/* ========== Autocomplete (CSV + Fallback) ========== */
const JOBS = [];
const MAX_SUG = 34;
const jobInput = $('job');
const sugList  = $('jobSuggest');
const JOB_FALLBACK = [
  "Lagerhelfer","Produktionsmitarbeiter","Pflegekraft","Staplerfahrer",
  "Kommissionierer","Küchenhilfe","Koch","Call-Center-Agent",
  "Schweißer","Elektriker","Bürokaufmann","Bürokauffrau","Reinigungskraft"
];

const debounce = (fn,ms)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms);} };
const norm = (s)=> (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');

function renderSuggestions(items){
  if(!items.length){sugList.classList.remove('show');sugList.innerHTML='';return;}
  sugList.innerHTML = items.slice(0,MAX_SUG).map((t,i)=>`<li role="option" data-idx="${i}">${t}</li>`).join('');
  sugList.classList.add('show');
}

function filterJobs(q){
  const n = norm(q);
  if(n.length < 4) return [];
  const starts = JOBS.filter(t=>norm(t).startsWith(n));
  const rest   = JOBS.filter(t=>!norm(t).startsWith(n) && norm(t).includes(n));
  return [...starts, ...rest].slice(0, MAX_SUG);
}

let activeIndex = -1;
jobInput.addEventListener('input', debounce(()=>{
  renderSuggestions(filterJobs(jobInput.value.trim()));
}, 120));

jobInput.addEventListener('keydown', (e)=>{
  const items=[...sugList.querySelectorAll('li')];
  if(!sugList.classList.contains('show') || !items.length) return;
  if(e.key==='ArrowDown'){e.preventDefault();activeIndex=(activeIndex+1)%items.length;}
  else if(e.key==='ArrowUp'){e.preventDefault();activeIndex=(activeIndex-1+items.length)%items.length;}
  else if(e.key==='Enter'){
    if(activeIndex>=0){e.preventDefault();jobInput.value=items[activeIndex].textContent;sugList.classList.remove('show');}
    return;
  } else return;
  items.forEach((li,i)=>li.setAttribute('aria-selected', i===activeIndex ? 'true' : 'false'));
  items[activeIndex].scrollIntoView({block:'nearest'});
});
sugList.addEventListener('click', (e)=>{
  const li = e.target.closest('li'); if(!li) return;
  jobInput.value = li.textContent; sugList.classList.remove('show'); jobInput.focus();
});
document.addEventListener('click', (e)=>{ if(!sugList.contains(e.target) && e.target!==jobInput) sugList.classList.remove('show'); });

(async function loadJobs(){
  try{
    const res = await fetch('assets/data/jobtitel.csv', {cache:'no-store'});
    if(!res.ok) throw new Error('CSV not found');
    const text = await res.text();
    const rows = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const uniq = Array.from(new Set(rows));
    uniq.sort((a,b)=>a.localeCompare(b,'de',{sensitivity:'base'}));
    JOBS.push(...uniq);
  }catch(err){
    JOBS.push(...JOB_FALLBACK);
  }
})();
</script>
</body>
</html>
