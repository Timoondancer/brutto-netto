<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Brutto/Netto Rechner – NACHTSCHICHT (25%) mit Dauernachtschicht</title>
  <style>
    :root { --pri:#0b1f3a; --acc:#b5dd35; --bg:#f7f7f8; }
    *{box-sizing:border-box} body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);margin:0;color:#111}
    .wrap{max-width:920px;margin:40px auto;padding:20px}
    .card{background:#fff;border:1px solid #eee;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.04);padding:24px}
    h1{margin:0 0 8px 0;font-size:24px} p.lead{margin:0 0 20px;color:#555}
    label{font-weight:600;font-size:14px;margin-bottom:8px;display:block}
    input,select{width:100%;padding:12px 14px;border:2px solid #e5e7eb;border-radius:12px;outline:none}
    input:focus,select:focus{border-color:var(--pri)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
    .mt{margin-top:16px} .mt2{margin-top:24px}
    .btn{display:inline-block;background:var(--pri);color:#fff;border:none;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
    .pill{display:inline-flex;align-items:center;gap:10px;background:#0b1f3a12;border:1px solid #0b1f3a20;border-radius:999px;padding:8px 12px}
    .switch{position:relative;width:56px;height:30px;background:#e5e7eb;border-radius:999px;cursor:pointer;transition:background .2s}
    .knob{position:absolute;top:3px;left:3px;width:24px;height:24px;background:#fff;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.15);transition:left .2s}
    .switch.on{background:var(--pri)} .switch.on .knob{left:29px}
    .flex{display:flex;align-items:center;gap:12px}
    .justify{display:flex;justify-content:space-between;align-items:center}
    .note{font-size:12px;color:#666}
    .result{background:#fafafa;border:1px dashed #e5e7eb;border-radius:12px;padding:16px}
    .kv{display:flex;justify-content:space-between;padding:10px 12px;border-radius:10px}
    .kv + .kv{margin-top:8px}
    .kv.head{background:#f3f4f6;font-weight:700}
    .hl{color:var(--acc);font-weight:800}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Brutto/Netto Rechner</h1>
      <p class="lead">NACHTSCHICHT-Zulage: <strong>+25&nbsp;%</strong> aufs anteilige Basis-Brutto (vor Abzügen). Mit <strong>Dauernachtschicht</strong>-Umschalter.</p>

      <div class="row mt">
        <div>
          <label for="gross">Monatliches Bruttogehalt (Basis)</label>
          <input id="gross" type="number" inputmode="decimal" placeholder="z. B. 3000" value="3000">
          <div class="note mt">Basis-Brutto, <em>ohne</em> Zuschläge.</div>
        </div>

        <div>
          <label>Schichtzulage</label>
          <div class="justify pill">
            <span>Dauernachtschicht (100&nbsp;% Nachtstunden)</span>
            <div id="permanentToggle" class="switch" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
          </div>
          <div class="note mt">Wenn aus, kannst du unten die Monatsstunden & Nachtstunden angeben.</div>
        </div>
      </div>

      <div id="hoursRow" class="row mt">
        <div>
          <label for="totalHours">Gesamtstunden (Monat)</label>
          <input id="totalHours" type="number" inputmode="decimal" placeholder="z. B. 168" value="168">
          <div class="note mt">Typisch: 160–176 Stunden/Monat (40h/Woche).</div>
        </div>
        <div>
          <label for="nightHours">Nachtstunden (Monat)</label>
          <input id="nightHours" type="number" inputmode="decimal" placeholder="z. B. 56" value="56">
          <div class="note mt">z. B. 1/3 der Zeit bei 3‑Schicht‑Modell.</div>
        </div>
      </div>

      <div class="row3 mt2">
        <div>
          <label for="taxClass">Steuerklasse</label>
          <select id="taxClass">
            <option value="1">I</option>
            <option value="2">II</option>
            <option value="3">III</option>
            <option value="4" selected>IV</option>
            <option value="5">V</option>
            <option value="6">VI</option>
          </select>
        </div>
        <div>
          <label for="church">Kirchensteuer</label>
          <select id="church">
            <option value="0">nein</option>
            <option value="8">8 %</option>
            <option value="9" selected>9 %</option>
          </select>
        </div>
        <div>
          <label for="state">Bundesland</label>
          <select id="state">
            <option>NRW</option>
            <option selected>Bayern</option>
            <option>Berlin</option>
            <option>Hamburg</option>
            <option>Hessen</option>
            <option>Niedersachsen</option>
            <option>Sachsen</option>
            <option>Thüringen</option>
          </select>
        </div>
      </div>

      <div class="mt2">
        <button id="calc" class="btn">Netto berechnen</button>
      </div>

      <div id="out" class="mt2 result" aria-live="polite"></div>
    </div>
  </div>

<script>
(function(){
  const el = (id)=>document.getElementById(id);

  const state = {
    permanent:false
  };

  // simplified demo deduction model
  function socialInsurance(gross){
    const sv = gross * 0.2; // placeholder
    return { total: sv, details: { sv } };
  }

  function wageTax(taxable, taxClass){
    let rate = 0.0;
    if (taxClass === "3") rate = 0.08;
    else if (taxClass === "5" || taxClass === "6") rate = 0.22;
    else rate = 0.15;
    return taxable * rate;
  }

  function churchTax(lohnsteuer, percent){
    return lohnsteuer * (percent/100);
  }

  function clamp(v, min, max){ return Math.min(max, Math.max(min, v)); }

  function calc(){
    const baseGross = Number(el('gross').value || 0);
    const taxClass = el('taxClass').value;
    const churchPct = Number(el('church').value || 0);

    // Anteil Nachtstunden
    let fraction = 1;
    if (!state.permanent){
      const totalHours = Number(el('totalHours').value || 0);
      const nightHours = Number(el('nightHours').value || 0);
      const f = totalHours > 0 ? nightHours / totalHours : 0;
      fraction = clamp(f, 0, 1);
    }

    // 25% Zuschlag – voll bei Dauernachtschicht, sonst anteilig
    const nightAllowance = baseGross * 0.25 * fraction;
    const grossEffective = baseGross + nightAllowance;

    // Deductions
    const sv = socialInsurance(grossEffective);
    const taxable = Math.max(0, grossEffective - sv.total);
    const lohnsteuer = wageTax(taxable, taxClass);
    const kirche = churchTax(lohnsteuer, churchPct);
    const totalDed = sv.total + lohnsteuer + kirche;
    const net = Math.max(0, grossEffective - totalDed);

    // Output
    const percentTxt = (fraction*100).toFixed(0) + "%";
    el('out').innerHTML = `
      <div class="kv head"><span>Brutto (Basis)</span><span>${baseGross.toFixed(2)} €</span></div>
      <div class="kv"><span>NACHTSCHICHT-Zulage (25% · ${state.permanent ? "Dauernacht" : percentTxt} der Stunden)</span><span>+ ${nightAllowance.toFixed(2)} €</span></div>
      <div class="kv head"><span>Brutto (effektiv)</span><span class="hl">${grossEffective.toFixed(2)} €</span></div>
      <div class="kv"><span>Sozialabgaben (Demo)</span><span>− ${sv.total.toFixed(2)} €</span></div>
      <div class="kv"><span>Lohnsteuer (Demo)</span><span>− ${lohnsteuer.toFixed(2)} €</span></div>
      <div class="kv"><span>Kirchensteuer</span><span>− ${kirche.toFixed(2)} €</span></div>
      <div class="kv head"><span>Netto (geschätzt)</span><span class="hl">${net.toFixed(2)} €</span></div>
      <div class="note mt">
        Hinweis: Steuersatz/Sozialversicherung hier stark vereinfacht als Demo – bitte in deiner Produktiv-App eure bestehende Logik verwenden und nur die Zuschlagsformel übernehmen:
        <code>nightAllowance = baseGross * 0.25 * fraction</code> mit <code>fraction = Dauernacht ? 1 : Nachtstunden/Gesamtstunden</code>.
      </div>
    `;
  }

  function togglePermanent(on){
    state.permanent = on;
    const t = document.getElementById('permanentToggle');
    const hoursRow = document.getElementById('hoursRow');
    if (on){
      t.classList.add('on'); t.setAttribute('aria-checked','true');
      hoursRow.classList.add('hidden');
    } else {
      t.classList.remove('on'); t.setAttribute('aria-checked','false');
      hoursRow.classList.remove('hidden');
    }
  }

  // UI handlers
  const t = document.getElementById('permanentToggle');
  t.addEventListener('click', ()=>{ togglePermanent(!state.permanent); calc(); });
  t.addEventListener('keydown', (e)=>{
    if(e.key === ' ' || e.key === 'Enter'){ e.preventDefault(); togglePermanent(!state.permanent); calc(); }
  });

  ['gross','taxClass','church','state','totalHours','nightHours'].forEach(id=>{
    const node = document.getElementById(id);
    if (!node) return;
    node.addEventListener('input', calc);
    node.addEventListener('change', calc);
  });
  document.getElementById('calc').addEventListener('click', calc);

  // initial render
  togglePermanent(false); // default: nicht Dauernacht
  calc();
})();
</script>
</body>
</html>
